<!-- Page Content -->
<div id="page-content-wrapper">
    <div class="container-fluid">
            <section>
                <div>
                    <div class="container">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                            <tr>
                              <th>Authors</th>
                              <th>Title</th>
                              <th>Status</th>
                            </tr>
                          </thead>
                        </table>
                    </div> 
                    </div>
                    </div> 
            </section>
    </div>
</div> <!-- /#page-content-wrapper -->

<div class="modal fade" id="assignReviewer" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title text-primary" id="exampleModalLabel">Select Reviewers To Assign</h5>
            <button class="close" id="closeModal" type="button">
                <span aria-hidden="true">Ã—</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card-body" id="">
              <form class="navbar-search" id="reviewerForm">
              <div class="table-responsive">
                <table class="table table-bordered" id="reviewerTable" width="100%" cellspacing="0">
          <thead>
        <tr>
          <th>ID</th>
          <th>Full Name</th>
          <th>Classification</th>
          <th></th>
        </tr>
      </thead>
    </table>
    <button class="btn btn-primary" id="reviewerAssign" type="submit">Assign As Reviewer</button>
  </div>
          </form>
                  </div>
        </div>
        <div class="modal-footer">
        </div>
    </div>
</div>
</div>



<script>
$(function() {
$(".navItem").click(function(event) {
    event.preventDefault();

    $('.navItem').removeClass("active").removeClass("on");
    $(this).addClass("active").addClass("on");
    var panel = $(this).attr('panel-id');

    $(".panel").hide();
    $("#"+panel).show();
});
});

//load data
$(function() {
function load_proposals(){
  $("#dataTable").DataTable({
  'processing': true,
  'serverSide': true,
  'dom': 'Blfrtip',
  'serverMethod': 'post',
  'ajax': {
    'url': '../include/displayproposal.php'
  },
  'columns': [
    {data: 'fullname'},
    {data: 'title'},
    {data: 'status'},
  ],
  rowGroup: {
        dataSrc: 'title',
                startRender: function (rows, title) {
                  var rTitle = title.toUpperCase();
            return `<h4 class="text-primary">${rTitle}</h4>`;
        },
    }
})
  }
    load_proposals();
    
    function open_modal(){
    $('#dataTable').on('click', '#testbtn', function(e) {
      e.preventDefault()
      var PID = $(this).attr('PID');
      console.log(PID)
      $('#assignReviewer').modal('show');
      $('#reviewerForm').append(`<input id="pid" name="PID" value="${PID}" hidden>`);
    })
  }
  open_modal();

  
  // $.ajax({
  //     url: '../forms/loadreviewers.php',
  //     type: 'get',
  //    dataType: 'JSON',
  //     success: function(response){
  //     response.forEach(({id, fName, lName, classification}) => {
  //     var reviewer=`<tr>
  //       <td align='center'>${id}</td>
  //       <td align='center'>${fName} ${lName}</td>
  //       <td align='center'>${classification}</td>
  //       <td><input type ='checkbox' class='revCb' value='${id}'></td>
  //       </tr>`;
  //           $("#reviewerBody").append(reviewer);
  //       }
  //     )}
  //   });
  // 

// load reviewer data
function load_reviewers(){
  $("#reviewerTable").DataTable({
  'processing': true,
  'serverSide': true,
  'serverMethod': 'post',
  'ajax': {
    'url': '../forms/loadreviewers.php'
  },
  'columns': [
    {data: 'userID'},
    {data: 'full_name'},
    {data: 'classification'},
    {data: 'checkbox'}
  ]
})
  }
    load_reviewers();

    function close_modal(){
      $("#closeModal").on('click', function(){
        $('#assignReviewer').modal('hide');
        $('#pid').remove();
      })
    }
    close_modal();

  })


    $('#reviewerForm').on('submit', function(e){
      e.preventDefault();
      var selected = [];
      var proposalid = $('#pid').attr('value');
      $('input[class="revCb"]:checked').map(function() {
        selected.push($(this).val())
      })

      // if(isEmpty(selected)){
      //   alert('No Reviewer Chosen. Please Try Again')
      // }
      bootbox.confirm("Assign Chosen Reviewer To This Research?", function(result) {
      if(result){
      $.ajax({
      url: '../forms/addreviewer.php?propid='+proposalid,
      type: 'post',
      data: {ids:selected},
     dataType: 'json',
      success: function(data){
        bootbox.alert(data.alert.msg);
        $('#assignReviewer').modal('hide');
        $('#pid').remove();
        $('.revCb').prop('checked', false);
      }
    });
  }
})
    })
     


//search

  // $("#tableSearch").on("keyup", function() {
  //   var value = $(this).val().toLowerCase();
  //   $("#myTable tr").filter(function() {
  //     var result = $(this).text().toLowerCase().indexOf(value);
  //     $(this).toggle(result > -1)
  //   });
  // });

  // $("#filter").change(function() {
  //   var value = $(this).val().toLowerCase();
  //   $("#myTable tr").filter(function() {
  //     var result = $(this).text().toLowerCase().indexOf(value);
  //     $(this).toggle(result > -1)
  //   });
  // });


</script>