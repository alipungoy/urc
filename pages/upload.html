<div class="row d-flex justify-content-center">
  <div class="col-lg-6">
<div class="card shadow mb-4">
  <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Research</h6>
  </div>
  <div class="card-body">
  <h1 class="text text-primary">Research Submission</h1>
  <hr> 
  <form id="form" method="post" enctype="multipart/form-data">
  <div class="form-group">
  <label for="name">Research title</label>
  <textarea type="text" class="form-control" id="title" name="title"  cols="30" rows="3" required></textarea>
  </div>
  <div class="form-group mr-2">
    <label for="funding">Funding Type:</label>
    <select class="form-control" name="funding" id="funding">
      <option value="0">Select Funding Type</option>
      <option value="Externally Funded Research">Externally Funded Research</option>
      <option value="Internally Funded Research">Internally Funded Research</option>
    </select><br>
  </div>
  <div class="form-group" id="mainAuth">
  </div>
  <div class="form-group mt-3">
    <label for="selectCoAuthor">Co Author</label>
    <select class="form-control" name="coAuth[]" id="selectCoAuthor">
  </select><br> 
  <small style="font-style:italic;color:blue">*Choose Co-Authors If Available</small>
  </div> 
  <div id="filename"></div>
  <div class="text-danger" id="err"></div>
  <div class="text-success" id="success"></div>
  </div>
  <div id="preview"></div>
  <button class="btn btn-primary" id="fileSelect">Choose File</button>
  <input id="uploadFile" type="file"  name="ftu" />
  <input class="btn btn-success" type="submit" value="Upload">
  </form>
  <div id="preview"></div>
  <hr>
  </div>
  </div>
</div>

<!-- <div class="modal fade" id="mainAuthorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title text-primary" id="exampleModalLabel">Select Main Author</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body">
          <div class="selectedAuth col-lg-12">
          </div>
            <div class="card-body">
              <form
              class="navbar-search" id="mainAuthForm">
              </div>
              <div class="table-responsive">
                <table class="table table-bordered" id="mainAuthorBody" width="100%" cellspacing="0">
          <thead>
        <tr>
          <th>Full Name</th>
          <th></th>
        </tr>
      </thead>
    </table>
    <button class="btn btn-primary" id="addAsMainAuthor">Add As Main Author</button>
  </div>
          </form>
                  </div>
        </div>
        <div class="modal-footer">
        </div>
    </div>
</div>
</div>

<div class="modal fade" id="coAuthorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title text-primary" id="exampleModalLabel">Select Co Author</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body">
          <div class="selectedCoAuth col-lg-12">
          </div>
            <div class="card-body" id="">
              <form
              class="navbar-search" id="coAuthForm">
              <div class="table-responsive">
                <table class="table table-bordered" id="coAuthorBody" width="100%" cellspacing="0">
          <thead>
        <tr>
          <th>Full Name</th>
          <th></th>
        </tr>
      </thead>
    </table>
    <button class="btn btn-primary" id="addAsCoAuthor">Add As Co Author</button>
  </div>
          </form>
                  </div>
        </div>
        <div class="modal-footer">
        </div>
    </div>
</div>
</div> -->



  
  
  <script>
 $(function() {
      $('#fileSelect').on('click',function(e){
         e.preventDefault();
         $("#preview").fadeOut();
         $('#uploadFile').trigger('click');
     });
  });
  $("#uploadFile").change(function() {
  filename = this.files[0].name
  $("#filename").html('<i class="fas fa-file-pdf fa-10x"></i>' + filename);
});

$('#funding').select2({
  minimumResultsForSearch: Infinity
});

$(function () {
  $.ajax({
   url:'../forms/loadname.php',
   type: "POST",
    dataType: 'json',
   success: function(data)
      {
        console.log(data)
        data.forEach(({fName, lName})=> {

         var mainAuthor = `<label for="country">Main Author</label>
    <input class="form-control" type="text" id="" name="mainAuthor" value="${fName} ${lName}" readonly>`;
         
          $('#mainAuth').append(mainAuthor)
        })
      }        
    });
  }
 );


        $('#selectCoAuthor').select2({
          multiple: true,
          maximumSelectionLength: 9,
            placeholder: 'Select Co Author',
            ajax: {
                url: '../forms/loadauthors.php',
                type: "post",
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        searchTerm: params.term // search term
                    };
                },
                processResults: function (response) {
                    return {
                        results:response
                    };
                },
                cache: true
            }
        });

        
// $(function (){
//   var max_option = 10;
//   var x = 1;

//   $('#addField').on('click', function (e){
//     e.preventDefault();
//     if(x < max_option){
//       x++;
//       $('.coauthor').append($('#names').clone())
//       $('.coauthor').append('<br>');
//     }
//   });
//   $('#addAuthor').on('click', '#removeField', function(e){
//     e.preventDefault();
//     $(this).parent('div').remove(); x--;
//   })
// });

//     $(function(){
//       $('#addMainAuthor').on('click', function(e){
//       e.preventDefault();
//       $('#mainAuthorModal').modal('show');
//     });
//     $("#mainAuthorBody").DataTable({
//   'processing': true,
//   'serverSide': true,
//   'dom': 'Bfrtip',
//   'serverMethod': 'post',
//   'ajax': {
//     'url': '../forms/loadauthors.php'
//   },
//   'columns': [
//     {data: 'fullname'},
//     {data: 'mainAuthCb'},
//   ]
// })
//   });

// $(function(){
//     $('#addCoAuthor').on('click', function(e){
//       e.preventDefault();
//       $('#coAuthorModal').modal('show');
//     });
//     $("#coAuthorBody").DataTable({
//   'processing': true,
//   'serverSide': true,
//   'dom': 'Bfrtip',
//   'serverMethod': 'post',
//   'ajax': {
//     'url': '../forms/loadauthors.php'
//   },
//   'columns': [
//     {data: 'fullname'},
//     {data: 'coAuthCb'},
//   ]
// })
//   });

//  multiple
// $(function(){
//   $('#addAsCoAuthor').on('click', function(e){
//     e.preventDefault();
//     var coauths = [];
//     $('input[id="coAuthCb"]:checked').each(function(){
//       coauths.push($(this).val());
//     })
//     $(coauths).css('backgroud-color: blue')

// });
//   })


// //Select main author and display selected
// $('#addAsMainAuthor').on('click', function(e){
//   e.preventDefault();
//   var values = new Array();
//   var counter =  $('input[id="mainAuthCb"]:checked').length;
//   $('.alert-danger').remove();
//   if(counter == 1){
//   $.each($('input[id="mainAuthCb"]:checked').closest('td').siblings('td:first-child'),function(){
//     values.push($(this).text());
//     })
//     console.log(values)
//     var display = `<div class='test-remove'><button class="btn btn-outline-primary btn-sm" id="remove">X</button><span class="badge badge-pill badge-primary">${values}</span></div>`;
//   $('.selectedAuth').append(display)
//   }
//   else{
//     $('.selectedAuth').append('<div class="alert alert-danger"> only 1 allowed</div>');
//   }

// });

// $('.selectedAuth').on('click', '#remove', function(e){
//   e.preventDefault();
//  $('.test-remove').remove();
//  $('input[id="mainAuthCb"]:checked').prop('checked', false);
// });

// //selec coAuhtor
// $('#addAsCoAuthor').on('click', function(e){
//   e.preventDefault();
//   var values = new Array();
//   var counter =  $('input[id="coAuthCb"]:checked').length;
//   $('.alert-danger').remove();
//   if(counter <= 9){
//   $.each($('input[id="coAuthCb"]:checked').closest('td').siblings('td:first-child'),function(){
//     values.push($(this).text());
//     })
//     console.log(values)
//     var display = `<div class='test-remove'><button class="btn btn-outline-primary btn-sm" id="remove">X</button><span class="badge badge-pill badge-primary">${values}</span></div>`;
//   $('.selectedCoAuth').append(display)
//   }
//   else{
//     $('.selectedCoAuth').append('<div class="alert alert-danger"> Maximum of 9 Co-Authors Allowed</div>');
//   }

// });

// //remove selected author
// $('.selectedAuth').on('click', '#remove', function(e){
//   e.preventDefault();
//  $('.test-remove').remove();
//  $('input[id="mainAuthCb"]:checked').prop('checked', false);
// });

// $('.selectedCoAuth').on('click', '#remove', function(e){
//   e.preventDefault();
//  $('.test-remove').remove();
//  $('input[id="coAuthCb"]:checked').prop('checked', false);
// });


  //Array being sent by ajax as string
  $(function () {
  $("#form").on('submit',(function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  $.ajax({
   url:'../forms/upload.php',
   type: "POST",
   data:  formData,
   contentType: false,
         cache: false,
   processData:false,
   beforeSend : function()
   {

    $("#err").fadeOut();
   },
   success: function(data)
      {
        console.log(data);
        if(data=='empty'){
          $("#err").html("No File Selected. Please select file").fadeIn(); 
        }
       else if(data=='existing'){
          $("#err").html("File already exist").fadeIn(); 
        }
    else if(data=='invalid')
    {
     // invalid file format.
     $("#err").html("Only PDF files are allowed").fadeIn();
    }
    else if (data=='ok')
    {
      $("#success").html("File upload success").fadeIn();
     $("#form")[0].reset(); 
    }
      },
     error: function(e) 
      {
    $("#err").html(e).fadeIn();
      }          
    });
  }
 ));
  })


// $(function(){
//   $("#authorSearch").on("keyup", function() {
//     var value = $(this).val().toLowerCase();
//     $("#mainAuthorBody tr").filter(function() {
//       var result = $(this).text().toLowerCase().indexOf(value);
//       $(this).toggle(result > -1)
//     });
//   });
// });

// $(function(){
//   $("#mainAuthorFilter").change(function() {
//     var value = $(this).val().toLowerCase();
//     $("#mainAuthorBody tr").filter(function() {
//       var result = $(this).text().toLowerCase().indexOf(value);
//       $(this).toggle(result > -1)
//     });
//   });
// });

// $(function(){
//   $("#coAuthorSearch").on("keyup", function() {
//     var value = $(this).val().toLowerCase();
//     $("#coAuthorBody tr").filter(function() {
//       var result = $(this).text().toLowerCase().indexOf(value);
//       $(this).toggle(result > -1)
//     });
//   });
// });

// $(function(){
//   $("#CoAuthorFilter").change(function() {
//     var value = $(this).val().toLowerCase();
//     $("#coAuthorBody tr").filter(function() {
//       var result = $(this).text().toLowerCase().indexOf(value);
//       $(this).toggle(result > -1)
//     });
//   });
// });

// $("#checkall").on('click', function(){
//     $('input:checkbox').not(this).prop('checked', this.checked);
// });
  </script>