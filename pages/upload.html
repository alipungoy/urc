<div class="row d-flex justify-content-center">
  <div class="col-lg-6">
<div class="card shadow mb-4">
  <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Research</h6>
  </div>
  <div class="card-body">
  <h1 class="text text-primary">Research Submission</h1>
  <hr> 
  <form id="form" method="post" enctype="multipart/form-data">
  <div class="form-group">
  <label for="name">Research title</label>
  <textarea type="text" class="form-control" id="title" name="title"  cols="30" rows="3" required></textarea>
  </div>
  <div class="form-group">
    <label for="funding">Funding Type:</label>
    <select class="form-control" name="funding" id="funding">
      <option value="Externally Funded Research">Externally funded Research</option>
      <option value="Internally Funded Research">Internally funded Research</option>
    </select><br>
  </div>
  <div class="form-group">
    <div id="addAuthor">    
      <button class="btn btn-primary form-control mb-2" id="addMainAuthor">Add Main Author</button>
      <button class="btn btn-primary form-control" id="addCoAuthor">Add Co Author</button>
  </div>
  </div>
  <div id="filename"></div>
  <div class="text-danger" id="err"></div>
  <div class="text-success" id="success"></div>
  </div>
  <div id="preview"></div>
  <button class="btn btn-primary" id="fileSelect">Choose File</button>
  <input id="uploadFile" type="file"  name="ftu" />
  <input class="btn btn-success" type="submit" value="Upload">
  </form>
  <div id="preview"></div>
  <hr>
  </div>
  </div>
</div>

<div class="modal fade" id="mainAuthorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title text-primary" id="exampleModalLabel">Select Main Author</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card-body" id="">
              <form
              class="navbar-search" id="mainAuthForm">
              <div class="input-group">
                  <input type="text" id="authorSearch" class="form-control bg-light border-0 small" placeholder="Search for Main Author"
                      aria-label="Search" aria-describedby="basic-addon2">
                  <div class="input-group-append">
                      <button class="btn btn-primary" type="button">
                          <i class="fas fa-search fa-sm"></i>
                      </button>
                  </div>
              </div>
              <select class="form-group mx-sm-3 mb-2" name="mainAuthorFilter" id="mainAuthorFilter">
                <option disabled selected="selectHelper" value="">Filter By College</option>
                <option value="College of Computer Studies">College of Computer Studies</option>
                <option value="">Test3</option>
              </select>
              <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
        <tr>
          <th>Full Name</th>
          <th>Department</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="mainAuthorBody"></tbody>
    </table>
    <button class="btn btn-primary" id="addAsMainAuthor">Add As Main Author</button>
  </div>
          </form>
                  </div>
        </div>
        <div class="modal-footer">
        </div>
    </div>
</div>
</div>

<div class="modal fade" id="coAuthorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title text-primary" id="exampleModalLabel">Select Co Author</h5>
            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card-body" id="">
              <form
              class="navbar-search" id="coAuthForm">
              <div class="input-group">
                  <input type="text" id="coAuthorSearch" class="form-control bg-light border-0 small" placeholder="Search for Co Author"
                      aria-label="Search" aria-describedby="basic-addon2">
                  <div class="input-group-append">
                      <button class="btn btn-primary" type="button">
                          <i class="fas fa-search fa-sm"></i>
                      </button>
                  </div>
              </div>
              <select class="form-group mx-sm-3 mb-2" name="coAuthorFilter" id="coAuthorFilter">
                <option disabled selected="selectHelper" value="">Filter By College</option>
                <option value="College of Computer Studies">College of Computer Studies</option>
                <option value="">Test3</option>
              </select>
              <div class="table-responsive">
                <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
          <thead>
        <tr>
          <th>Full Name</th>
          <th>Department</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="coAuthorBody"></tbody>
    </table>
    <button class="btn btn-primary" id="addAsCoAuthor" type="submit">Add As Co Author</button>
  </div>
          </form>
                  </div>
        </div>
        <div class="modal-footer">
        </div>
    </div>
</div>
</div>



  
  
  <script>
 $(function() {
      $('#fileSelect').on('click',function(e){
         e.preventDefault();
         $("#preview").fadeOut();
         $('#uploadFile').trigger('click');
     });
  });
  $("#uploadFile").change(function() {
  filename = this.files[0].name
  $("#filename").html('<i class="fas fa-file-pdf fa-10x"></i>' + filename);
});

// $(function (){
//   var max_option = 10;
//   var x = 1;

//   $('#addField').on('click', function (e){
//     e.preventDefault();
//     if(x < max_option){
//       x++;
//       $('.coauthor').append($('#names').clone())
//       $('.coauthor').append('<br>');
//     }
//   });
//   $('#addAuthor').on('click', '#removeField', function(e){
//     e.preventDefault();
//     $(this).parent('div').remove(); x--;
//   })
// });

    $(function(){
      $('#addMainAuthor').on('click', function(e){
      e.preventDefault();
      $('#mainAuthorModal').modal('show');
    });
    $.ajax({
        url: '../forms/loadauthors.php',
        type: 'post',
        dataType: 'JSON',
        success: function(response){
            response.forEach(({ fullname, dept, id }) => {
              var author=`<tr>
        <td align='center'>${fullname}</td>
        <td align='center'>${dept}</td>
        <td><input type ='checkbox' id='mainAuthCb' value='${id}' PID='${id}'></td>
      </tr>`;

              $("#mainAuthorBody").append(author);
            })
        }
    });
});

$(function(){
    $('#addCoAuthor').on('click', function(e){
      e.preventDefault();
      $('#coAuthorModal').modal('show');
    });
    $.ajax({
        url: '../forms/loadauthors.php',
        type: 'post',
        dataType: 'JSON',
        success: function(response){
            response.forEach(({ fullname, dept, id }) => {
              var author=`<tr>
        <td align='center'>${fullname}</td>
        <td align='center'>${dept}</td>
        <td><input type ='checkbox' name="coAuthorCb[]" id='coAuthCb' value='${id}' PID='${id}'></td>
      </tr>`;
              $("#coAuthorBody").append(author);
            })
        }
    });
});

//  multiple
// $(function(){
//   $('#addAsCoAuthor').on('click', function(e){
//     e.preventDefault();
//     var coauths = [];
//     $('input[id="coAuthCb"]:checked').each(function(){
//       coauths.push($(this).val());
//     })
//     $(coauths).css('backgroud-color: blue')

// });
//   })

  //Array being sent by ajax as string
  $(function () {
  $("#form").on('submit',(function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  var mainAuth = [];
    $('input[id="mainAuthCb"]:checked').map(function(){
      mainAuth.push($(this).val());
    })
    formData.append('mainAuthor', mainAuth);
  var coauths = [];
    $('input[id="coAuthCb"]:checked').map(function(){
      coauths.push($(this).val());
    })
  formData.append('coAuthor', JSON.stringify(coauths));
  console.log(formData);

  $.ajax({
   url:'../forms/upload.php',
   type: "POST",
   data:  formData,
   contentType: false,
         cache: false,
   processData:false,
   beforeSend : function()
   {
    $("#err").fadeOut();
   },
   success: function(data)
      {
        console.log(data);
        if(data=='empty'){
          $("#err").html("No File Selected. Please select file").fadeIn(); 
        }
       else if(data=='existing'){
          $("#err").html("File already exist").fadeIn(); 
        }
    else if(data=='invalid')
    {
     // invalid file format.
     $("#err").html("Only PDF files are allowed").fadeIn();
    }
    else if (data=='ok')
    {
      $("#success").html("File upload success").fadeIn();
     $("#form")[0].reset(); 
    }
      },
     error: function(e) 
      {
    $("#err").html(e).fadeIn();
      }          
    });
 }));
  })


$(function(){
  $("#authorSearch").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#mainAuthorBody tr").filter(function() {
      var result = $(this).text().toLowerCase().indexOf(value);
      $(this).toggle(result > -1)
    });
  });
});

$(function(){
  $("#mainAuthorFilter").change(function() {
    var value = $(this).val().toLowerCase();
    $("#mainAuthorBody tr").filter(function() {
      var result = $(this).text().toLowerCase().indexOf(value);
      $(this).toggle(result > -1)
    });
  });
});

$(function(){
  $("#coAuthorSearch").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#coAuthorBody tr").filter(function() {
      var result = $(this).text().toLowerCase().indexOf(value);
      $(this).toggle(result > -1)
    });
  });
});

$(function(){
  $("#CoAuthorFilter").change(function() {
    var value = $(this).val().toLowerCase();
    $("#coAuthorBody tr").filter(function() {
      var result = $(this).text().toLowerCase().indexOf(value);
      $(this).toggle(result > -1)
    });
  });
});

// $("#checkall").on('click', function(){
//     $('input:checkbox').not(this).prop('checked', this.checked);
// });
  </script>