<section>
    <header>
        <h4>Add News</h4>
    </header>
    <div class="row">
        <div class="col-12">
            <form id="addNews_form">
                <div class="body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input name="title" id="title" type="input" class="form-control" required>
                    </div>
                    <div class="editor">
                        <div class="mb-3">
                            <textarea name="details" id="editor" required></textarea>
                            <div class="mt-4 d-flex justify-content-end">
                                <button type="button" id="clear" class="btn btn-danger">Cancel</button>
                                <button type="submit" class="btn btn-success ml-2">Add News</button>
                            </div>
                        </div>
                    </div>
                    <!-- <div id="toolbar"></div> -->
                    <!-- <div class="mb-3">
                        <label class="form-label">Images</label>
                        <input name="imahge" type="file" class="form-control" required>
                    </div> -->
                </div>
            </form>
        </div>
    </div>
    <!-- <div class="col-6 container">
            <header><h5>Preview</h5></header>
            <div id="titlePrev"></div>
            <div id="preview">
                
            </div>
        </div> -->
    </div>
</section>


<script>
    $(document).ready(function () {
        //editor
        // DecoupledEditor.create(document.querySelector("#editor"), {
        //     ckfinder: {
        //         uploadUrl: 'libs/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Files&responseType=json',
        //     },

        // })
        //     .then(editor => {
        //         const toolbarContainer = document.querySelector('#toolbar');
        //         const plugins = DecoupledEditor.builtinPlugins.map( plugin => plugin.pluginName );

        //         toolbarContainer.appendChild(editor.ui.view.toolbar.element);
        //         editor.editing.view.focus();
        //         fileContent = editor;



        //         console.log(plugins)
        //     })
        //     .catch(error => {
        //         console.error(error);
        //     });

        var editor = new FroalaEditor('#editor', {
            toolbarSticky: true,
            scrollableContainer: '.editor',
            imageUploadURL: './forms/upload_image.php',
            imageDefaultWidth: 480,
            imageUploadParams: {
                id: 'my_editor'
            },
            dragInline: false,
            pluginsEnabled: ['image', 'link', 'draggable', 'align'],

        })


        $("#addNews_form").submit(function (e) {
            e.preventDefault()

            $.ajax({
                type: "POST",
                url: 'api/post/news.php',
                data: $('#addNews_form').serializeArray(),
                dataType: "json",
                success: function (data) {
                    alert(data.message || 'Something went wrong');

                    if (data.type === 'success') {
                        location.reload();
                    }
                },
                error: (e) => {
                    alert(e.responseText || 'Something went wrong')
                }
            });
        });

        // $('#editor').on('keyup', function() {
        //     const contents = fileContent.getData();
        //     const title = $('#title').val();

        //     $('#preview').html(contents);
        //     $('#titlePrev').html(title);
        // });

        // //clear field
        // $('#clear').click(function () {
        //     const editor = new FroalaEditor('#editor', function() {})
        //     const body = $('#editor').FroalaEditor('html.set');
        //     $('#title').val('');
        // })
    });
</script>